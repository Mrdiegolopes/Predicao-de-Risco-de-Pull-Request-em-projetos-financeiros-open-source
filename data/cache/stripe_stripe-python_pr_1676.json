{"url": "https://api.github.com/repos/stripe/stripe-python/pulls/1676", "id": 3020164810, "node_id": "PR_kwDOAB3Obc60BA7K", "html_url": "https://github.com/stripe/stripe-python/pull/1676", "diff_url": "https://github.com/stripe/stripe-python/pull/1676.diff", "patch_url": "https://github.com/stripe/stripe-python/pull/1676.patch", "issue_url": "https://api.github.com/repos/stripe/stripe-python/issues/1676", "number": 1676, "state": "closed", "locked": false, "title": "Add create_async method to EphemeralKey", "user": {"login": "praniketkw", "id": 239043282, "node_id": "U_kgDODj-C0g", "avatar_url": "https://avatars.githubusercontent.com/u/239043282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/praniketkw", "html_url": "https://github.com/praniketkw", "followers_url": "https://api.github.com/users/praniketkw/followers", "following_url": "https://api.github.com/users/praniketkw/following{/other_user}", "gists_url": "https://api.github.com/users/praniketkw/gists{/gist_id}", "starred_url": "https://api.github.com/users/praniketkw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/praniketkw/subscriptions", "organizations_url": "https://api.github.com/users/praniketkw/orgs", "repos_url": "https://api.github.com/users/praniketkw/repos", "events_url": "https://api.github.com/users/praniketkw/events{/privacy}", "received_events_url": "https://api.github.com/users/praniketkw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Implements async version of EphemeralKey.create() method to support asynchronous workflows. The method maintains the same validation requirements (stripe_version must be specified) and follows the established pattern used by other async methods in the codebase. Also adds return type annotation to the existing create() method for improved type safety.\r\n\r\nFixes #1502\r\n\r\n### Why?\r\nCurrently, the EphemeralKey class only provides a synchronous create() method, which limits its use in async applications. While the new StripeClient API includes ephemeral_keys.create_async(), users of the legacy API pattern (using stripe.EphemeralKey.create()) do not have an async option. This creates an inconsistency with other resources like ApplePayDomain, Source, and PaymentMethod that provide both sync and async create methods.\r\n\r\nThis PR addresses issue #1502 by implementing the missing create_async() method, allowing developers using async frameworks to create ephemeral keys without blocking their event loops or needing to migrate to the StripeClient API.\r\n\r\n### What?\r\nImplemented create_async() classmethod that mirrors the behavior of create() with the following changes:\r\n\r\nUses cls._static_request_async() for asynchronous API calls, following the same pattern as delete_async() in the same class\r\n\r\nMaintains the required stripe_version validation that raises ValueError when the parameter is missing\r\n\r\nAdded return type annotations (-> \"EphemeralKey\") to both create() and create_async() methods for improved type safety, addressing the comment in #1502 about missing type hints\r\n\r\nIncludes proper use of cast() for type safety and docstrings consistent with other methods in the codebase\r\n\r\nAdded comprehensive test coverage with TestEphemeralKeyAsync class that verifies correct behavior and validation using pytest.mark.anyio\r\n\r\nAll code passes linting (flake8, ruff) and type checking with no errors\r\n\r\n### Verification\r\n\r\nThe implementation has been verified to work correctly. Method exists as an async classmethod, both create() and create_async() have proper return type annotations, and validation correctly raises ValueError when stripe_version is missing. All linting and type checking passes without errors.\r\n\r\n### See Also\r\nIssue #1502:\r\n\r\nReference implementation pattern from ApplePayDomain: https://github.com/stripe/stripe-python/blob/master/stripe/_apple_pay_domain.py\r\n\r\nExisting EphemeralKeyService.create_async() in the StripeClient API: https://github.com/stripe/stripe-python/blob/master/stripe/_ephemeral_key_service.py#L99\r\n", "created_at": "2025-11-18T06:11:47Z", "updated_at": "2025-11-25T00:00:14Z", "closed_at": "2025-11-24T22:54:41Z", "merged_at": "2025-11-24T22:54:41Z", "merge_commit_sha": "b1ae771d7dcf2ac6cd3d5859ee6aeef29a422a1a", "assignee": null, "assignees": [], "requested_reviewers": [{"login": "xavdid-stripe", "id": 109395161, "node_id": "U_kgDOBoU82Q", "avatar_url": "https://avatars.githubusercontent.com/u/109395161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xavdid-stripe", "html_url": "https://github.com/xavdid-stripe", "followers_url": "https://api.github.com/users/xavdid-stripe/followers", "following_url": "https://api.github.com/users/xavdid-stripe/following{/other_user}", "gists_url": "https://api.github.com/users/xavdid-stripe/gists{/gist_id}", "starred_url": "https://api.github.com/users/xavdid-stripe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xavdid-stripe/subscriptions", "organizations_url": "https://api.github.com/users/xavdid-stripe/orgs", "repos_url": "https://api.github.com/users/xavdid-stripe/repos", "events_url": "https://api.github.com/users/xavdid-stripe/events{/privacy}", "received_events_url": "https://api.github.com/users/xavdid-stripe/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "requested_teams": [], "labels": [], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/stripe/stripe-python/pulls/1676/commits", "review_comments_url": "https://api.github.com/repos/stripe/stripe-python/pulls/1676/comments", "review_comment_url": "https://api.github.com/repos/stripe/stripe-python/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/stripe/stripe-python/issues/1676/comments", "statuses_url": "https://api.github.com/repos/stripe/stripe-python/statuses/526edf9efb21bd15904d1cd0f2ac45f66f25d241", "head": {"label": "praniketkw:add-ephemeral-key-create-async", "ref": "add-ephemeral-key-create-async", "sha": "526edf9efb21bd15904d1cd0f2ac45f66f25d241", "user": {"login": "praniketkw", "id": 239043282, "node_id": "U_kgDODj-C0g", "avatar_url": "https://avatars.githubusercontent.com/u/239043282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/praniketkw", "html_url": "https://github.com/praniketkw", "followers_url": "https://api.github.com/users/praniketkw/followers", "following_url": "https://api.github.com/users/praniketkw/following{/other_user}", "gists_url": "https://api.github.com/users/praniketkw/gists{/gist_id}", "starred_url": "https://api.github.com/users/praniketkw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/praniketkw/subscriptions", "organizations_url": "https://api.github.com/users/praniketkw/orgs", "repos_url": "https://api.github.com/users/praniketkw/repos", "events_url": "https://api.github.com/users/praniketkw/events{/privacy}", "received_events_url": "https://api.github.com/users/praniketkw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "repo": {"id": 1098765854, "node_id": "R_kgDOQX3WHg", "name": "stripe-python", "full_name": "praniketkw/stripe-python", "private": false, "owner": {"login": "praniketkw", "id": 239043282, "node_id": "U_kgDODj-C0g", "avatar_url": "https://avatars.githubusercontent.com/u/239043282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/praniketkw", "html_url": "https://github.com/praniketkw", "followers_url": "https://api.github.com/users/praniketkw/followers", "following_url": "https://api.github.com/users/praniketkw/following{/other_user}", "gists_url": "https://api.github.com/users/praniketkw/gists{/gist_id}", "starred_url": "https://api.github.com/users/praniketkw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/praniketkw/subscriptions", "organizations_url": "https://api.github.com/users/praniketkw/orgs", "repos_url": "https://api.github.com/users/praniketkw/repos", "events_url": "https://api.github.com/users/praniketkw/events{/privacy}", "received_events_url": "https://api.github.com/users/praniketkw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/praniketkw/stripe-python", "description": "Python library for the Stripe API.    ", "fork": true, "url": "https://api.github.com/repos/praniketkw/stripe-python", "forks_url": "https://api.github.com/repos/praniketkw/stripe-python/forks", "keys_url": "https://api.github.com/repos/praniketkw/stripe-python/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/praniketkw/stripe-python/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/praniketkw/stripe-python/teams", "hooks_url": "https://api.github.com/repos/praniketkw/stripe-python/hooks", "issue_events_url": "https://api.github.com/repos/praniketkw/stripe-python/issues/events{/number}", "events_url": "https://api.github.com/repos/praniketkw/stripe-python/events", "assignees_url": "https://api.github.com/repos/praniketkw/stripe-python/assignees{/user}", "branches_url": "https://api.github.com/repos/praniketkw/stripe-python/branches{/branch}", "tags_url": "https://api.github.com/repos/praniketkw/stripe-python/tags", "blobs_url": "https://api.github.com/repos/praniketkw/stripe-python/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/praniketkw/stripe-python/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/praniketkw/stripe-python/git/refs{/sha}", "trees_url": "https://api.github.com/repos/praniketkw/stripe-python/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/praniketkw/stripe-python/statuses/{sha}", "languages_url": "https://api.github.com/repos/praniketkw/stripe-python/languages", "stargazers_url": "https://api.github.com/repos/praniketkw/stripe-python/stargazers", "contributors_url": "https://api.github.com/repos/praniketkw/stripe-python/contributors", "subscribers_url": "https://api.github.com/repos/praniketkw/stripe-python/subscribers", "subscription_url": "https://api.github.com/repos/praniketkw/stripe-python/subscription", "commits_url": "https://api.github.com/repos/praniketkw/stripe-python/commits{/sha}", "git_commits_url": "https://api.github.com/repos/praniketkw/stripe-python/git/commits{/sha}", "comments_url": "https://api.github.com/repos/praniketkw/stripe-python/comments{/number}", "issue_comment_url": "https://api.github.com/repos/praniketkw/stripe-python/issues/comments{/number}", "contents_url": "https://api.github.com/repos/praniketkw/stripe-python/contents/{+path}", "compare_url": "https://api.github.com/repos/praniketkw/stripe-python/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/praniketkw/stripe-python/merges", "archive_url": "https://api.github.com/repos/praniketkw/stripe-python/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/praniketkw/stripe-python/downloads", "issues_url": "https://api.github.com/repos/praniketkw/stripe-python/issues{/number}", "pulls_url": "https://api.github.com/repos/praniketkw/stripe-python/pulls{/number}", "milestones_url": "https://api.github.com/repos/praniketkw/stripe-python/milestones{/number}", "notifications_url": "https://api.github.com/repos/praniketkw/stripe-python/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/praniketkw/stripe-python/labels{/name}", "releases_url": "https://api.github.com/repos/praniketkw/stripe-python/releases{/id}", "deployments_url": "https://api.github.com/repos/praniketkw/stripe-python/deployments", "created_at": "2025-11-18T05:42:01Z", "updated_at": "2025-11-25T18:21:09Z", "pushed_at": "2025-12-23T06:09:08Z", "git_url": "git://github.com/praniketkw/stripe-python.git", "ssh_url": "git@github.com:praniketkw/stripe-python.git", "clone_url": "https://github.com/praniketkw/stripe-python.git", "svn_url": "https://github.com/praniketkw/stripe-python", "homepage": "https://stripe.com", "size": 10403, "stargazers_count": 0, "watchers_count": 0, "language": "Python", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "mit", "name": "MIT License", "spdx_id": "MIT", "url": "https://api.github.com/licenses/mit", "node_id": "MDc6TGljZW5zZTEz"}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "stripe:master", "ref": "master", "sha": "93cdfb85b5f9cf63fb4eef77c3c6e8da3e81ba7c", "user": {"login": "stripe", "id": 856813, "node_id": "MDEyOk9yZ2FuaXphdGlvbjg1NjgxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/856813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stripe", "html_url": "https://github.com/stripe", "followers_url": "https://api.github.com/users/stripe/followers", "following_url": "https://api.github.com/users/stripe/following{/other_user}", "gists_url": "https://api.github.com/users/stripe/gists{/gist_id}", "starred_url": "https://api.github.com/users/stripe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stripe/subscriptions", "organizations_url": "https://api.github.com/users/stripe/orgs", "repos_url": "https://api.github.com/users/stripe/repos", "events_url": "https://api.github.com/users/stripe/events{/privacy}", "received_events_url": "https://api.github.com/users/stripe/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "repo": {"id": 1953389, "node_id": "MDEwOlJlcG9zaXRvcnkxOTUzMzg5", "name": "stripe-python", "full_name": "stripe/stripe-python", "private": false, "owner": {"login": "stripe", "id": 856813, "node_id": "MDEyOk9yZ2FuaXphdGlvbjg1NjgxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/856813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stripe", "html_url": "https://github.com/stripe", "followers_url": "https://api.github.com/users/stripe/followers", "following_url": "https://api.github.com/users/stripe/following{/other_user}", "gists_url": "https://api.github.com/users/stripe/gists{/gist_id}", "starred_url": "https://api.github.com/users/stripe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stripe/subscriptions", "organizations_url": "https://api.github.com/users/stripe/orgs", "repos_url": "https://api.github.com/users/stripe/repos", "events_url": "https://api.github.com/users/stripe/events{/privacy}", "received_events_url": "https://api.github.com/users/stripe/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/stripe/stripe-python", "description": "Python library for the Stripe API.    ", "fork": false, "url": "https://api.github.com/repos/stripe/stripe-python", "forks_url": "https://api.github.com/repos/stripe/stripe-python/forks", "keys_url": "https://api.github.com/repos/stripe/stripe-python/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/stripe/stripe-python/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/stripe/stripe-python/teams", "hooks_url": "https://api.github.com/repos/stripe/stripe-python/hooks", "issue_events_url": "https://api.github.com/repos/stripe/stripe-python/issues/events{/number}", "events_url": "https://api.github.com/repos/stripe/stripe-python/events", "assignees_url": "https://api.github.com/repos/stripe/stripe-python/assignees{/user}", "branches_url": "https://api.github.com/repos/stripe/stripe-python/branches{/branch}", "tags_url": "https://api.github.com/repos/stripe/stripe-python/tags", "blobs_url": "https://api.github.com/repos/stripe/stripe-python/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/stripe/stripe-python/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/stripe/stripe-python/git/refs{/sha}", "trees_url": "https://api.github.com/repos/stripe/stripe-python/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/stripe/stripe-python/statuses/{sha}", "languages_url": "https://api.github.com/repos/stripe/stripe-python/languages", "stargazers_url": "https://api.github.com/repos/stripe/stripe-python/stargazers", "contributors_url": "https://api.github.com/repos/stripe/stripe-python/contributors", "subscribers_url": "https://api.github.com/repos/stripe/stripe-python/subscribers", "subscription_url": "https://api.github.com/repos/stripe/stripe-python/subscription", "commits_url": "https://api.github.com/repos/stripe/stripe-python/commits{/sha}", "git_commits_url": "https://api.github.com/repos/stripe/stripe-python/git/commits{/sha}", "comments_url": "https://api.github.com/repos/stripe/stripe-python/comments{/number}", "issue_comment_url": "https://api.github.com/repos/stripe/stripe-python/issues/comments{/number}", "contents_url": "https://api.github.com/repos/stripe/stripe-python/contents/{+path}", "compare_url": "https://api.github.com/repos/stripe/stripe-python/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/stripe/stripe-python/merges", "archive_url": "https://api.github.com/repos/stripe/stripe-python/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/stripe/stripe-python/downloads", "issues_url": "https://api.github.com/repos/stripe/stripe-python/issues{/number}", "pulls_url": "https://api.github.com/repos/stripe/stripe-python/pulls{/number}", "milestones_url": "https://api.github.com/repos/stripe/stripe-python/milestones{/number}", "notifications_url": "https://api.github.com/repos/stripe/stripe-python/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/stripe/stripe-python/labels{/name}", "releases_url": "https://api.github.com/repos/stripe/stripe-python/releases{/id}", "deployments_url": "https://api.github.com/repos/stripe/stripe-python/deployments", "created_at": "2011-06-25T19:53:04Z", "updated_at": "2026-01-17T16:02:23Z", "pushed_at": "2026-01-19T00:25:01Z", "git_url": "git://github.com/stripe/stripe-python.git", "ssh_url": "org-856813@github.com:stripe/stripe-python.git", "clone_url": "https://github.com/stripe/stripe-python.git", "svn_url": "https://github.com/stripe/stripe-python", "homepage": "https://stripe.com", "size": 28946, "stargazers_count": 1941, "watchers_count": 1941, "language": "Python", "has_issues": true, "has_projects": false, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": false, "forks_count": 484, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 20, "license": {"key": "mit", "name": "MIT License", "spdx_id": "MIT", "url": "https://api.github.com/licenses/mit", "node_id": "MDc6TGljZW5zZTEz"}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["stripe", "stripe-sdk"], "visibility": "public", "forks": 484, "open_issues": 20, "watchers": 1941, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/stripe/stripe-python/pulls/1676"}, "html": {"href": "https://github.com/stripe/stripe-python/pull/1676"}, "issue": {"href": "https://api.github.com/repos/stripe/stripe-python/issues/1676"}, "comments": {"href": "https://api.github.com/repos/stripe/stripe-python/issues/1676/comments"}, "review_comments": {"href": "https://api.github.com/repos/stripe/stripe-python/pulls/1676/comments"}, "review_comment": {"href": "https://api.github.com/repos/stripe/stripe-python/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/stripe/stripe-python/pulls/1676/commits"}, "statuses": {"href": "https://api.github.com/repos/stripe/stripe-python/statuses/526edf9efb21bd15904d1cd0f2ac45f66f25d241"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "ramya-stripe", "id": 100975018, "node_id": "U_kgDOBgTBqg", "avatar_url": "https://avatars.githubusercontent.com/u/100975018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ramya-stripe", "html_url": "https://github.com/ramya-stripe", "followers_url": "https://api.github.com/users/ramya-stripe/followers", "following_url": "https://api.github.com/users/ramya-stripe/following{/other_user}", "gists_url": "https://api.github.com/users/ramya-stripe/gists{/gist_id}", "starred_url": "https://api.github.com/users/ramya-stripe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ramya-stripe/subscriptions", "organizations_url": "https://api.github.com/users/ramya-stripe/orgs", "repos_url": "https://api.github.com/users/ramya-stripe/repos", "events_url": "https://api.github.com/users/ramya-stripe/events{/privacy}", "received_events_url": "https://api.github.com/users/ramya-stripe/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "comments": 5, "review_comments": 0, "maintainer_can_modify": false, "commits": 2, "additions": 57, "deletions": 6, "changed_files": 2}